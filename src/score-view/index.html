<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <title>Entropic Endeavors - Score View</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    // Your p5.js code goes here
    let messages = [];
    let currentMessage = '';
    let fadeDuration = 2000; // Duration of fade effect in milliseconds
    let displayDuration = 4000; // Duration to display the message in milliseconds
    let fadeInStart = 0;
    let fadeOutStart = 0;
    let displayStart = 0;
    let fadeIn = false;
    let fadeOut = false;
    let displaying = false;
    let xPos, yPos;

    function setup() {
      createCanvas(windowWidth, windowHeight);
      xPos = random(width);
      yPos = random(height);
      getMessage(); // Fetch a message immediately upon starting the sketch
    }

    function draw() {
      background(220);
      fill(0);
      textSize(32);

  if (fadeIn) {
    let fadeInElapsedTime = millis() - fadeInStart;
    let fadeInAlpha = map(fadeInElapsedTime, 0, fadeDuration, 0, 255);
    fill(0, fadeInAlpha);
    text(currentMessage, xPos, yPos);
    
    if (fadeInElapsedTime > fadeDuration) {
      fadeIn = false;
      displaying = true;
      displayStart = millis();
    }
  } else if (displaying) {
    text(currentMessage, xPos, yPos);

    let displayElapsedTime = millis() - displayStart;
    if (displayElapsedTime > displayDuration) {
      displaying = false;
      fadeOut = true;
      fadeOutStart = millis();
    }
  } else if (fadeOut) {
    let fadeOutElapsedTime = millis() - fadeOutStart;
    let fadeOutAlpha = map(fadeOutElapsedTime, 0, fadeDuration, 255, 0);
    fill(0, fadeOutAlpha);
    text(currentMessage, xPos, yPos);

    if (fadeOutElapsedTime > fadeDuration) {
      fadeOut = false;
      getMessage(); // Fetch a new message after fade out
    }
  }

    }

    function getMessage() {
      fetch('/messages')
        .then(response => response.json())
        .then(data => {
          if (data.text.length > 0) {
            currentMessage = data.text;          
            fadeIn = true;
            fadeInStart = millis(); // Record the start time for the fade in effect
            xPos = random(width);
            yPos = random(height);
          }
        })
        .catch(error => {
          console.log('Error fetching messages:', error);
        });
    }
  </script>
</body>
</html>
